<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Apply - FUBK Launchpad</title>
    <meta name="description" content="Apply to become a contributor to the FUBK Flow open-source student utility app.">
    <meta name="author" content="FUBK Flow Team">
    <link rel="canonical" href="https://fubk-launchpad.netlify.app/apply.html" /> 

    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸš€</text></svg>">

    <meta name="theme-color" content="#ffffff">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'fubk-accent': '#2563eb', // Deep blue
                        'fubk-bg': '#ffffff',     // Pure white background for flat look
                        'fubk-text': '#1f2937',     // Gray-800 for softer contrast
                        'fubk-muted': '#6b7280',   // Gray-500 for secondary text
                        'fubk-border': '#e5e7eb',  // Gray-200 for subtle borders
                        'fubk-input-bg': '#f9fafb', // Slightly off-white for inputs
                        
                        /* MODIFICATION: Added error color */
                        'fubk-error': '#dc2626' // red-600
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body { font-feature-settings: "cv02", "cv03", "cv04", "cv11"; }
        .lucide { width: 1.25em; height: 1.25em; stroke-width: 1.5; }
        textarea::-webkit-scrollbar { width: 8px; }
        textarea::-webkit-scrollbar-track { background: #f1f5f9; }
        textarea::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        textarea::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-fubk-bg text-fubk-text font-sans min-h-screen antialiased selection:bg-blue-100 selection:text-blue-900 flex flex-col">

    <header class="fixed top-0 left-0 w-full z-50 bg-white/80 backdrop-blur-md border-b border-fubk-border">
        <div class="max-w-3xl mx-auto px-6 flex justify-between items-center py-5">
            <a href="index.html" class="group flex items-center space-x-3 hover:opacity-80 transition-opacity">
                <img src="assets/images/fubk-logo.jpg" class="h-12 w-12 rounded-full">
               
            </a>
            <a href="index.html" class="text-sm text-fubk-muted hover:text-fubk-text flex items-center transition-colors">
                <i data-lucide="arrow-left" class="w-4 h-4 mr-1"></i> Back to Home
            </a>
        </div>
    </header>

    <main class="max-w-3xl mx-auto px-6 md:px-8 pb-24 pt-32"> 
        <form id="contributorForm" novalidate> <section class="p-6 bg-blue-50 border border-blue-200 rounded-xl">
                <h3 class="flex items-center text-lg font-semibold text-fubk-accent mb-4">
                    <i data-lucide="shield-check" class="mr-2 w-5 h-5"></i> 1. Project Agreement
                </h3>
                <p class="text-gray-600 text-sm mb-6 leading-relaxed">
                    Collaboration requires trust. Please read the <a href="conduct.html" target="_blank" class="text-fubk-accent font-medium hover:underline decoration-1 underline-offset-4">Project Overview & Code of Conduct</a> before proceeding.
                </p>
                <label class="flex items-start space-x-3 cursor-pointer group">
                    <input type="checkbox" id="agreement" name="agreement" class="mt-1 form-checkbox h-5 w-5 text-fubk-accent rounded border-gray-300 focus:ring-fubk-accent">
                    <span class="text-sm text-fubk-text group-hover:text-black transition-colors">
                        I confirm I have read the project overview and agree to the Code of Conduct.
                    </span>
                </label>
                <p id="agreementError" class="text-fubk-error text-xs mt-2 hidden">You must agree to the Code of Conduct to continue.</p>
            </section>

            <fieldset id="formSections" disabled class="space-y-12 opacity-50 mt-12 transition-opacity">

                <section class="space-y-6">
                    <div class="flex items-center justify-between border-b border-fubk-border pb-4">
                        <h3 class="text-xl font-bold text-fubk-text">2. Identity & Cohort</h3>
                        <i data-lucide="user-circle" class="text-gray-400"></i>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label for="fullName" class="text-sm font-medium text-gray-700 ml-1">Full Name</label>
                            <input type="text" id="fullName" name="fullName" placeholder="e.g. Ibrahim Musa" 
                                class="w-full px-4 py-3 bg-fubk-input-bg border border-fubk-border rounded-lg text-fubk-text placeholder-gray-400 focus:border-fubk-accent focus:ring-1 focus:ring-fubk-accent outline-none transition-all">
                            <p id="fullNameError" class="text-fubk-error text-xs ml-1 hidden">Full name is required.</p>
                        </div>
                        <div class="space-y-2">
                            <label for="admissionNo" class="text-sm font-medium text-gray-700 ml-1">Admission No.</label>
                            <input type="text" id="admissionNo" name="admissionNo" placeholder="e.g. 123456789" 
                                class="w-full px-4 py-3 bg-fubk-input-bg border border-fubk-border rounded-lg text-fubk-text placeholder-gray-400 focus:border-fubk-accent focus:ring-1 focus:ring-fubk-accent outline-none transition-all">
                            <p id="admissionNoError" class="text-fubk-error text-xs ml-1 hidden">Admission number is required.</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label for="fubkEmail" class="text-sm font-medium text-gray-700 ml-1">Official FUBK Email</Lgabel>
                            <input type="email" id="fubkEmail" name="fubkEmail" placeholder="your.name@fubk.edu.ng" 
                                class="w-full px-4 py-3 bg-fubk-input-bg border border-fubk-border rounded-lg text-fubk-text placeholder-gray-400 focus:border-fubk-accent focus:ring-1 focus:ring-fubk-accent outline-none transition-all">
                            <p id="fubkEmailError" class="text-fubk-error text-xs ml-1 hidden">A valid @fubk.edu.ng email is required.</p>
                        </div>
                        <div class="space-y-2">
                            <label for="currentLevel" class="text-sm font-medium text-gray-700 ml-1">Current Level</label>
                            <div class="relative">
                                <select id="currentLevel" name="currentLevel" 
                                    class="w-full px-4 py-3 bg-fubk-input-bg border border-fubk-border rounded-lg text-fubk-text appearance-none focus:border-fubk-accent focus:ring-1 focus:ring-fubk-accent outline-none transition-all">
                                    <option value="" disabled selected>Select Level</option>
                                    <option value="100L">100L</option>
                                    <option value="200L">200L</option>
                                    <option value="300L">300L</option>
                                    <option value="400L">400L (Final Year)</option>
                                    <option value="500L">500L (Engineering/Law)</option>
                                </select>
                                <i data-lucide="chevron-down" class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none w-5 h-5"></i>
                            </div>
                            <p id="currentLevelError" class="text-fubk-error text-xs ml-1 hidden">Please select your level.</p>
                        </div>
                    </div>
                </section>

                <section class="space-y-8">
                    <div class="flex items-center justify-between border-b border-fubk-border pb-4">
                        <h3 class="text-xl font-bold text-fubk-text">3. Skills & Assessment</h3>
                        <i data-lucide="code-2" class="text-gray-400"></i>
                    </div>

                    <div class="space-y-3">
                        <label for="weeklyCommitment" class="text-sm font-medium text-fubk-accent ml-1 uppercase tracking-wider">Weekly Availability</label>
                        <div class="relative">
                            <select id="weeklyCommitment" name="weeklyCommitment" 
                                class="w-full px-4 py-3 bg-fubk-input-bg border border-fubk-border rounded-lg text-fubk-text appearance-none focus:border-fubk-accent focus:ring-1 focus:ring-fubk-accent outline-none transition-all">
                                <option value="" disabled selected>How much time can you commit?</option>
                                <option value="2-4 hours">2-4 hours/week (Documentation/Testing)</option>
                                <option value="4-8 hours">4-8 hours/week (Good for small features)</option>
                                <option value="8+ hours">8+ hours/week (Core Maintainer)</option>
                            </select>
                            <i data-lucide="clock" class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none w-5 h-5"></i>
                        </div>
                        <p id="weeklyCommitmentError" class="text-fubk-error text-xs ml-1 hidden">Please select your availability.</p>
                    </div>

                    <div class="space-y-4">
                        <span class="text-sm font-medium text-fubk-accent ml-1 uppercase tracking-wider">Tool Familiarity (Check all that apply)</span>
                        <div class="grid grid-cols-2 gap-3">
                           <label class="flex items-center p-3 border border-fubk-border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                                <input type="checkbox" name="toolFamiliarity" value="Git/GitHub" class="form-checkbox h-5 w-5 text-fubk-accent rounded border-gray-300 focus:ring-0">
                                <span class="ml-3 text-fubk-text">Git / GitHub</span>
                            </label>
                            <label class="flex items-center p-3 border border-fubk-border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                                <input type="checkbox" name="toolFamiliarity" value="HTML/CSS" class="form-checkbox h-5 w-5 text-fubk-accent rounded border-gray-300 focus:ring-0">
                                <span class="ml-3 text-fubk-text">HTML / CSS</span>
                            </label>
                            <label class="flex items-center p-3 border border-fubk-border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                                <input type="checkbox" name="toolFamiliarity" value="JavaScript" class="form-checkbox h-5 w-5 text-fubk-accent rounded border-gray-300 focus:ring-0">
                                <span class="ml-3 text-fubk-text">JavaScript</span>
                            </label>
                            <label class="flex items-center p-3 border border-fubk-border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                                <input type="checkbox" name="toolFamiliarity" value="React Native" class="form-checkbox h-5 w-5 text-fubk-accent rounded border-gray-300 focus:ring-0">
                                <span class="ml-3 text-fubk-text">React Native</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <span class="text-sm font-medium text-fubk-accent ml-1 uppercase tracking-wider">Preferred Role(s) (Check all that apply)</span>
                        <div class="grid grid-cols-2 gap-3">
                            <label class="flex items-center p-3 border border-fubk-border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                                <input type="checkbox" name="preferredRoles" value="HTML/CSS/UI" class="form-checkbox h-5 w-5 text-fubk-accent rounded border-gray-300 focus:ring-0">
                                <span class="ml-3 text-fubk-text">HTML/CSS/UI Design</span>
                            </label>
                            <label class="flex items-center p-3 border border-fubk-border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                                <input type="checkbox" name="preferredRoles" value="Documentation/QA" class="form-checkbox h-5 w-5 text-fubk-accent rounded border-gray-300 focus:ring-0">
                                <span class="ml-3 text-fubk-text">Documentation/Testing</span>
                            </label>
                            <label class="flex items-center p-3 border border-fubk-border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                                <input type="checkbox" id="roleBackend" name="preferredRoles" value="Backend/Logic" class="form-checkbox h-5 w-5 text-fubk-accent rounded border-gray-300 focus:ring-0">
                                <span class="ml-3 text-fubk-text">Backend/Security Logic</span>
                            </label>
                        </div>
                    </div>

                    <div id="backendQuestions" class="hidden space-y-2 p-4 border border-fubk-accent/30 rounded-xl bg-blue-50">
                        <label for="backendExperience" class="flex items-center text-sm font-bold text-fubk-accent ml-1">
                            <i data-lucide="server-cog" class="w-4 h-4 mr-2"></i>
                            Backend/Security Follow-up
                        </label>
                        <p class="text-sm text-gray-600 ml-1 mb-2">Since you're interested in backend, what's your experience with server-side tech?</p>
                        <input type="text" id="backendExperience" name="backendExperience" placeholder="e.g. Node.js, PHP, Python, Supabase" 
                            class="w-full px-4 py-3 bg-white border border-fubk-border rounded-lg text-fubk-text placeholder-gray-400 focus:border-fubk-accent focus:ring-1 focus:ring-fubk-accent outline-none transition-all">
                    </div>
                    
                    <div class="space-y-2">
                        <label for="reasonForJoining" class="text-sm font-medium text-gray-700 ml-1">Why do you want to join FUBK Flow? (Min. 10 words)</label>
                        <textarea id="reasonForJoining" name="reasonForJoining" rows="4" placeholder="Tell us about your motivation..." 
                            class="w-full px-4 py-3 bg-fubk-input-bg border border-fubk-border rounded-lg text-fubk-text placeholder-gray-400 focus:border-fubk-accent focus:ring-1 focus:ring-fubk-accent outline-none transition-all resize-none"></textarea>
                        <p id="reasonForJoiningError" class="text-xs text-fubk-muted ml-1">0/10 words</p>
                    </div>

                    <div class="space-y-2 p-4 border border-fubk-accent/30 rounded-xl bg-blue-50">
                        <label for="challengeResponse" class="flex items-center text-sm font-bold text-fubk-accent ml-1">
                            <i data-lucide="terminal" class="w-4 h-4 mr-2"></i>
                            Skill Challenge: Briefly explain the difference between Git and GitHub.
                        </label>
                        <textarea id="challengeResponse" name="challengeResponse" rows="3" placeholder="Your answer here..." 
                            class="w-full px-4 py-3 bg-white border border-fubk-border rounded-lg text-fubk-text placeholder-gray-400 focus:border-fubk-accent focus:ring-1 focus:ring-fubk-accent outline-none transition-all resize-none"></textarea>
                        <p id="challengeResponseError" class="text-fubk-error text-xs ml-1 hidden">This answer is required.</p>
                    </div>
                </section>
                
                <div class="pt-6">
                    <button type="submit" id="submitButton" class="group relative w-full inline-flex items-center justify-center py-3.5 px-10 text-lg font-bold text-white rounded-xl overflow-hidden transition-all duration-300 bg-gradient-to-r from-fubk-accent to-blue-600 hover:scale-[1.02]">
                        <span class="relative flex items-center">
                            Submit Application
                            <i data-lucide="send" class="lucide ml-3 w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                        </span>
                    </button>
                    <p class="text-center text-xs text-gray-500 mt-4">
                        <i data-lucide="lock" class="inline-block w-3 h-3 mr-1"></i>
                        Data is securely processed via Supabase Edge Functions.
                    </p>
                </div>

            </fieldset> 
        </form>
    </main>
    
    <footer class="border-t border-fubk-border bg-gray-50 py-12 mt-24">
       <div class="max-w-3xl mx-auto px-6 flex flex-col md:flex-row justify-between items-center">
            <div class="mb-6 md:mb-0 text-center md:text-left">
                <p class="text-lg font-bold text-fubk-text">FUBK Flow</p>
                <p class="text-xs text-fubk-muted mt-1">Open-source student utility.</p>
            </div>
            <div class="flex space-x-6 items-center">
                <a href="conduct.html" class="text-xs font-medium text-fubk-muted hover:text-fubk-accent transition-colors">Code of Conduct</a>
                <a href="privacy.html" class="text-xs font-medium text-fubk-muted hover:text-fubk-accent transition-colors">Privacy Policy</a>
                <a href="https://github.com/orgs/fubk-Flow/repositories" class="text-fubk-muted hover:text-fubk-text transition-colors">
                    <span class="sr-only">GitHub</span>
                    <i data-lucide="github" class="lucide w-5 h-5"></i>
                </a>
            </div>
        </div>
    </footer>


    <script>
        // --- CRITICAL: Update these URLs ---
        const SUPABASE_EDGE_FUNCTION_URL = 'https://[YOUR-PROJECT-REF].supabase.co/functions/v1/submit-contributor-application'; 
        const SUPABASE_ANON_KEY = '[YOUR_SUPABASE_ANON_KEY]'; 
        
        document.addEventListener('DOMContentLoaded', () => {
    
            // --- 1. LUCIDE ICON INITIALIZATION ---
            try {
                lucide.createIcons();
            } catch (e) {
                console.error("Lucide icons failed to load:", e);
            }

            // --- 2. "SMART" FORM UX LOGIC ---

            // --- Feature A: Enable form on Agreement ---
            const agreementCheck = document.getElementById('agreement');
            const formSections = document.getElementById('formSections');

            if (agreementCheck && formSections) {
                agreementCheck.addEventListener('change', () => {
                    if (agreementCheck.checked) {
                        formSections.disabled = false;
                        formSections.classList.remove('opacity-50');
                        clearError('agreement'); // MODIFICATION: Clear error on check
                    } else {
                        formSections.disabled = true;
                        formSections.classList.add('opacity-50');
                    }
                });
            }
            
            // --- Feature B: Live Word Count ---
            const reasonInput = document.getElementById('reasonForJoining');
            const minWords = 10;
            
            if (reasonInput) {
                reasonInput.addEventListener('input', () => { // MODIFICATION: Changed to 'input'
                    // This function now handles word count AND clearing the error
                    validateReasonForJoining(reasonInput.value, minWords);
                });
            }

            // --- Feature C: Conditional Backend Question ---
            const roleBackendCheck = document.getElementById('roleBackend');
            const backendQuestions = document.getElementById('backendQuestions');

            if (roleBackendCheck && backendQuestions) {
                roleBackendCheck.addEventListener('change', () => {
                    if (roleBackendCheck.checked) {
                        backendQuestions.classList.remove('hidden');
                    } else {
                        backendQuestions.classList.add('hidden');
                        document.getElementById('backendExperience').value = ''; 
                    }
                });
            }

            // --- MODIFICATION: 3. NEW CUSTOM VALIDATION LOGIC ---
            
            const fieldMap = {
                agreement: document.getElementById('agreement'),
                fullName: document.getElementById('fullName'),
                admissionNo: document.getElementById('admissionNo'),
                fubkEmail: document.getElementById('fubkEmail'),
                currentLevel: document.getElementById('currentLevel'),
                weeklyCommitment: document.getElementById('weeklyCommitment'),
                reasonForJoining: document.getElementById('reasonForJoining'),
                challengeResponse: document.getElementById('challengeResponse'),
            };

            // Helper to show an error
            function showError(id, message) {
                const element = fieldMap[id];
                const errorElement = document.getElementById(`${id}Error`);
                
                if (errorElement) {
                    errorElement.textContent = message;
                    errorElement.classList.remove('hidden');
                    // Special handling for word count helper
                    if (id === 'reasonForJoining') {
                        errorElement.classList.add('text-fubk-error');
                        errorElement.classList.remove('text-fubk-muted', 'text-green-600');
                    }
                }
                
                // Add red border to non-checkbox inputs
                if (element && id !== 'agreement') {
                    element.classList.add('border-fubk-error', 'focus:border-fubk-error', 'focus:ring-fubk-error');
                    element.classList.remove('border-fubk-border', 'focus:border-fubk-accent', 'focus:ring-fubk-accent');
                }
            }

            // Helper to clear an error
            function clearError(id) {
                const element = fieldMap[id];
                const errorElement = document.getElementById(`${id}Error`);
                
                if (errorElement) {
                    errorElement.classList.add('hidden');
                    // Special handling for word count helper
                    if (id === 'reasonForJoining') {
                        validateReasonForJoining(element.value, minWords); // Reset to word count
                    }
                }
                
                // Remove red border from non-checkbox inputs
                if (element && id !== 'agreement') {
                    element.classList.remove('border-fubk-error', 'focus:border-fubk-error', 'focus:ring-fubk-error');
                    element.classList.add('border-fubk-border', 'focus:border-fubk-accent', 'focus:ring-fubk-accent');
                }
            }

            // Specific validator for the word count field
            function validateReasonForJoining(value, minWords) {
                const text = value.trim();
                const wordCount = text === '' ? 0 : text.split(/\s+/).length;
                const errorElement = document.getElementById('reasonForJoiningError');
                
                errorElement.textContent = `${wordCount}/${minWords} words`;
                errorElement.classList.remove('hidden', 'text-fubk-error'); // Show it

                if (wordCount >= minWords) {
                    errorElement.classList.add('text-green-600');
                    errorElement.classList.remove('text-fubk-muted');
                    clearError('reasonForJoining'); // Clear the "border" error
                } else {
                    errorElement.classList.add('text-fubk-muted');
                    errorElement.classList.remove('text-green-600');
                }
            }
            
            // Central Validation Function
            function validateForm(data) {
                let isValid = true;
                
                // 1. Agreement
                if (!data.agreement) {
                    showError('agreement', 'You must agree to the Code of Conduct to continue.');
                    isValid = false;
                } else {
                    clearError('agreement');
                }

                // 2. Full Name
                if (!data.full_name) {
                    showError('fullName', 'Full name is required.');
                    isValid = false;
                } else {
                    clearError('fullName');
                }

                // 3. Admission No
                if (!data.admission_no) {
                    showError('admissionNo', 'Admission number is required.');
                    isValid = false;
                } else {
                    clearError('admissionNo');
                }

                // 4. FUBK Email
                if (!data.fubk_email) {
                    showError('fubkEmail', 'Email is required.');
                    isValid = false;
                } else if (!data.fubk_email.endsWith('@fubk.edu.ng')) {
                    showError('fubkEmail', 'Must be a valid @fubk.edu.ng email.');
                    isValid = false;
                } else {
                    clearError('fubkEmail');
                }

                // 5. Current Level
                if (!data.current_level) {
                    showError('currentLevel', 'Please select your level.');
                    isValid = false;
                } else {
                    clearError('currentLevel');
                }

                // 6. Weekly Commitment
                if (!data.weekly_commitment) {
                    showError('weeklyCommitment', 'Please select your availability.');
                    isValid = false;
                } else {
                    clearError('weeklyCommitment');
                }

                // 7. Reason for Joining
                if (!data.reason_for_joining) {
                    showError('reasonForJoining', 'Reason for joining is required.');
                    isValid = false;
                } else if (data.reason_for_joining.split(/\s+/).length < minWords) {
                    showError('reasonForJoining', `Please provide at least ${minWords} words.`);
                    isValid = false;
                } else {
                    clearError('reasonForJoining');
                }

                // 8. Challenge Response
                if (!data.challenge_response) {
                    showError('challengeResponse', 'This answer is required.');
                    isValid = false;
                } else {
                    clearError('challengeResponse');
                }

                return isValid;
            }
            
            // --- Add listeners to clear errors on input ---
            Object.keys(fieldMap).forEach(id => {
                const element = fieldMap[id];
                if (element) {
                    const eventType = (element.tagName === 'SELECT' || id === 'agreement') ? 'change' : 'input';
                    if (id !== 'reasonForJoining') { // reasonForJoining has its own special listener
                         element.addEventListener(eventType, () => clearError(id));
                    }
                }
            });


            // --- 4. FORM SUBMISSION LOGIC ---
            const contributorForm = document.getElementById('contributorForm');
            const submitButton = document.getElementById('submitButton');

            if (contributorForm) {
                contributorForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const formData = new FormData(contributorForm);
                    const data = {};
                    
                    const preferredRoles = formData.getAll('preferredRoles');
                    const toolFamiliarity = formData.getAll('toolFamiliarity');

                    for (const [key, value] of formData.entries()) {
                        if (key !== 'preferredRoles' && key !== 'toolFamiliarity') {
                            data[key] = value.trim();
                        }
                    }

                    const finalData = {
                        ...data,
                        preferred_roles: preferredRoles,
                        tool_familiarity: toolFamiliarity,
                        agreement: document.getElementById('agreement').checked,
                        full_name: data.fullName,
                        admission_no: data.admissionNo,
                        fubk_email: data.fubkEmail,
                        current_level: data.currentLevel,
                        weekly_commitment: data.weeklyCommitment,
                        challenge_response: data.challengeResponse,
                        reason_for_joining: data.reasonForJoining,
                        backend_experience: data.backendExperience || null
                    };

                    // --- MODIFICATION: Run new validation ---
                    const isValid = validateForm(finalData);

                    if (!isValid) {
                        console.log("Validation failed");
                        // Scroll to the first error
                        const firstError = document.querySelector('.border-fubk-error, #agreementError:not(.hidden)');
                        if (firstError) {
                            firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                        return; // Stop the submission
                    }

                    // --- Validation passed, proceed with submission ---
                    submitButton.disabled = true;
                    submitButton.textContent = 'Submitting...';

                    try {
                        const response = await fetch(SUPABASE_EDGE_FUNCTION_URL, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'apikey': SUPABASE_ANON_KEY
                            },
                            body: JSON.stringify(finalData),
                        });

                        const result = await response.json();

                        if (response.ok && result.success) {
                            alert('Application submitted successfully! We will contact you soon.'); // Using alert() here for success is fine
                            contributorForm.reset();
                            window.location.href = 'index.html'; 
                        } else {
                            alert(`Submission Error: ${result.error || 'Unknown error occurred.'}`);
                        }

                    } catch (error) {
                        console.error('Network or Fetch Error:', error);
                        alert('A network error occurred. Please check your connection and try again.');
                    } finally {
                        submitButton.disabled = false;
                        submitButton.textContent = 'Submit Application';
                    }
                });
            }

        }); // End of DOMContentLoaded
    </script>
</body>
</html>